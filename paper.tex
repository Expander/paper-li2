\documentclass[10pt,DIV16,twocolumn,numbers=noenddot]{scrartcl}

\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{amsmath,amssymb}
\usepackage[german]{authblk}
\usepackage[format=plain,labelfont={bf}]{caption}
\usepackage{listings}
\usepackage[shortcuts]{extdash} % \-/
\usepackage{xcolor}
\usepackage{widetext}
\usepackage{hyperref}

\newcommand{\mytitle}{An algorithm for the calculation of the real dilogarithm with instruction-level parallelism}
\newcommand{\myauthor}{Alexander Voigt}
\newcommand{\Li}{\operatorname{Li}_2}

% source code highlighting
\lstset{breaklines=true,
  breakatwhitespace=true,
  % numbers=left,
  % stepnumber=1,
  basicstyle=\ttfamily\lst@ifdisplaystyle\footnotesize\fi, % code block in smaller font
  commentstyle=\ttfamily,
  prebreak={\textbackslash},
  breakindent=10pt,
  breakautoindent=false,
  showspaces=false,
  showstringspaces=false,
  frame=single,
  rulesep=0.1em,
  abovecaptionskip=0em,
  aboveskip=1.5em,
  belowcaptionskip=0.5em,
  belowskip=1em,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
  commentstyle=\color{gray},
}

\hypersetup{
  pdftitle   = {\mytitle},
  pdfauthor  = {\myauthor},
  colorlinks = true,
  linkcolor  = blue,
  citecolor  = blue,
  urlcolor   = blue,
  linkcolor  = blue
}

\title{\mytitle}
\author{\myauthor}
\affil{Fachbereich Energie und Biotechnologie, Hochschule Flensburg,\\ Kanzleistra{\ss}e 91--93, 24943 Flensburg, Germany}
\date{\today}

\begin{document}
\maketitle

\section*{Abstract}

An algorithm for the computation of the real dilogarithm is presented,
which allows for the use of instruction\-/level parallelism.

\section{Introduction}

The dilogarithm \cite{lewin} is a special function, which appears in
many physics applications, for example in the calculation of quantum
corrections in quantum field theory.  The investigation of new models
beyond the Standard Model of particle physics with a large parameter
space require the evaluation of the dilogarithm (and other functions)
billions of times.  Such investigations thus require a fast evaluation
of the dilogarithm.  In the past many time-efficient algorithms have
been invented (see e.g.~\cite{koelbigDilog,ginsberg,morris}) and many
are implemented, for example, in general-purpose physics and
mathematics program libraries \cite{root,gsl,cephes}.

The development of modern CPUs with support for instruction\-/level
parallelism (ILP) opens the opportunity for a further reduction of the
runtime of the calculation of the dilogarithm, given an appropriate
formulation of the algorithm.  In this paper an algorithm for the
calculation of the real dilogarithm $\Li$ is presented, which makes
use of ILP, resulting in a reduced runtime compared to the algorithms
presented so far.  A C implementation of this algorithm can be found
in the appendix and in the arXiv submission of this paper.

\section{Comparison of different implementation strategies}

As a toy example we consider the function $\ln(1+x)$, which has the
Taylor expansion
%
\begin{align}
  \ln(1+x) \approx x - \frac{x^2}{2} + \frac{x^3}{3} - \frac{x^4}{4} + \frac{x^5}{5} - \frac{x^6}{6} + \frac{x^7}{7}
  \label{eq:taylor}
\end{align}
%
around $x=0$ for $x\in(-1,1]$, where terms of $O(x^8)$ and beyond have
been omitted.  In the following we will briefly study various possible
implementations of this function and compare the performance of the
different implementations.  For brevity we will restrict ourselves to
$x\in(-1,1]$.  In C the function in Eq.~\eqref{eq:taylor} could be
implemented very naively as follows:
%
\lstinputlisting[language=C]{src/log1p_naive.c}
%
This naive implementation requires 26 floating\-/point multiplications
and 6 floating\-/point additions.\footnote{Modern compilers usually
  rewrite expensive floating\-/point divisions by a constant, such as
  $x/2$, as less expensive floating\-/point multiplication by a
  constant, for example as $0.5x$.  In the following we will therefore
  count a division of a variable by a constant as a floating\-/point
  multiplication.}

As is well known, the performante of this naive implementation can be
improved by applying Horner's scheme, which reduces the number of
expensive floating\-/point multiplications to 7 and requires 6
additions:
%
\begin{align}
\begin{split}
  \ln(1+x) \approx{}& x \Bigg\{1 + x \Bigg[-\frac{1}{2} + x \Bigg(\frac{1}{3} + x \Bigg\{-\frac{1}{4} \\
  &+ x \Bigg[\frac{1}{5} + x\Bigg(-\frac{1}{6} + \frac{x}{7}\Bigg)\Bigg]\Bigg\}\Bigg)\Bigg]\Bigg\}.
\end{split}\label{eq:horner}%
\end{align}
%
A C implementation using Horner's scheme could read
%
\lstinputlisting[language=C]{src/log1p_horner.c}

Several modern CPU architectures support instruction\-/level
parallelism (ILP), which allows for the execution of multiple
instructions at the same time.  To make use of ILP, one could use
Estrin's scheme \cite{estrin} to rewrite the function as
%
\begin{align}
\begin{split}
  \ln(1+x) \approx{}& x + \left(\frac{x}{3}-\frac{1}{2}\right)
    y \\ &+\left[\left(\frac{x}{7}-\frac{1}{6}\right)
    y+\frac{x}{5}-\frac{1}{4}\right] z,
\end{split}\label{eq:estrin}%
\end{align}
%
where $y=x^2$ and $z=y^2$.  This form requires 8 floating\-/point
multiplications and 6 additions, i.e.\ more multiplications than
Horner's scheme.  However, in Estrin's form several terms can be
executed in parallel, leading to a potential speed-up if the cost of
the additional multiplications is smaller than the gain by the
parallel execution.  A C implementation using Estrin's scheme could
read:
%
\lstinputlisting[language=C]{src/log1p_estrin.c}

To exploit ILP further, one could use a rational function
approximation, such as a Padé approximant \cite{pade}, where the
numerator and the denominator can be calculated in parallel.  A Padé
approximant of $\ln(1+x)$ at the same order as Eq.~\eqref{eq:taylor}
reads
%
\begin{align}
  \ln(1+x) \approx x
  \frac{\frac{320 x^3}{40143}+\frac{44320 x^2}{120429}+\frac{51064
    x}{40143}+1}{\frac{5120 x^3}{40143}+\frac{12320 x^2}{13381}+\frac{23712
    x}{13381}+1}.
  \label{eq:pade}
\end{align}
%
A naive C implementation of Eq.~\eqref{eq:pade} could read:
%
\lstinputlisting[language=C]{src/log1p_pade.c}
%
The numerator and the denominator of Eq.~\eqref{eq:pade} can be
re-written using Estrin's scheme, allowing for further ILP:
%
\begin{align}
  \ln(1+x) \approx x
  \frac{\left(\frac{320 x}{40143}+\frac{44320}{120429}\right)y+\frac{51064
    x}{40143}+1}{\left(\frac{5120 x}{40143}+\frac{12320}{13381}\right)y+\frac{23712
    x}{13381}+1},
  \label{eq:mixed}
\end{align}
%
where $y=x^2$.  A C implementation could read:
%
\lstinputlisting[language=C]{src/log1p_mixed.c}
%
Note that the value $y=x^2$ can be re-used in the calculation of both
the numerator and in the denominator.  This ``mixed'' implementation
requires 8 floating\-/point multiplications, 1 floating\-/point
division and 6 additions.  The rational function approximation
\eqref{eq:mixed} may be faster for long numerator/denominator
polynomials, where the cost of the floating\-/point division is
smaller than the gain by the parallel execution.


\section{An ILP-aware algorithm for the real dilogarithm}

In the following an ILP-aware implementation of the real dilogarithm
is presented, which allows for the parallel execution of different
floating\-/point operations.  The real dilogarithm is defined as
%
\begin{align}
  \Li(x) &= -\int_0^x \frac{\ln(1-t)}{t}dt, &
  &(x<1).
\end{align}
%
For $|x|<1$ the real dilogarithm has the series representation
%
\begin{align}
  \Li(x) = \sum_{k=1}^\infty \frac{x^k}{k^2}.
  \label{eq:series}
\end{align}
%
Further series representations exist, for example the accelerated
series
%
\begin{align}
  \Li(x) = \sum_{k=0}^\infty \frac{B_k}{(k+1)!} [-\ln(1-x)]^{k+1},
\end{align}
%
where $B_k$ are the Bernoulli numbers.  A series representation in
terms of Chebyshev polynomials of the first kind $T_n(x)$ is given in
\cite{luke},
%
\begin{align}
  \Li(x) = \sum_{k=0}^\infty a_n T_n(2x-1),
  \label{eq:cheby}
\end{align}
%
which is used for example in the ROOT program library \cite{root}.
The r.h.s.\ of Eqs.~\eqref{eq:series}--\eqref{eq:cheby} can be summed,
for example, using Horner's scheme or Clenshaw's algorithm
\cite{clenshaw}.  These summation techniques are, however, purely
sequential and thus do not make use of ILP.  In the following an
approximation of the real dilogarithm is presented, which makes use of
ILP, using a rational function approximation in combination with
Estrin's scheme, similar to the approach used in
Eq.~\eqref{eq:mixed}.%
\footnote{The Cephes library \cite{cephes} implements an equivalent
  rational function approximation for Spence's function
  $\operatorname{Sp}(x)=\Li(1-x)$.}

We define the real dilogarithm $\Li(x)$ for all $x\in\mathbb{R}$ as
the real part of its complex continuation.  The real dilogarithm can
be mapped onto the interval $[0,1/2]$ by using the following
identities:
%
\begin{widetext}%
\begin{align}%
  \Li(x) &= \Li\left(\frac{1}{1-x}\right) - \frac{\pi^2}{6} + \ln(1-x)\left[\frac{1}{2}\ln(1-x) - \ln(-x)\right], && (x<-1), \\
  \Li(x) &= -\Li\left(\frac{x}{x-1}\right) - \frac{1}{2}\ln^2(1-x), && (-1<x<0), \\
  \Li(x) &= -\Li(1-x) + \frac{\pi^2}{6} - \ln(x) \ln(1-x), && (\frac{1}{2}\leq x<1), \\
  \Li(x) &= \Li\left(1-\frac{1}{x}\right) + \frac{\pi^2}{6} - \ln(x)\left[\ln\left(1-\frac{1}{x}\right) + \frac{1}{2}\ln(x)\right], && (1<x<2), \\
  \Li(x) &= -\Li\left(\frac{1}{x}\right) + \frac{\pi^2}{3} - \frac{1}{2} \ln^2(x), && (x\geq 2),%
\end{align}%
\end{widetext}%
%
as well as the special values $\Li(0)=0$, $\Li(1)=\pi^2/6$ and
$\Li(-1)=-\pi^2/12$.

\section{Conclusions}

C, C++ and FORTRAN implementations of the presented algorithm can be
found in the Polylogarithm library \cite{polylogarithm}.

\appendix

\section{Implementation of the real dilogarithm}

\lstinputlisting[language=C]{anc/Li2.c}


\bibliographystyle{ieeetr}
\bibliography{paper}

\end{document}
